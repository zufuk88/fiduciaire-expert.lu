---
import Layout from '../layouts/Layout.astro';

// Récupération et tri des articles
const allPosts = await Astro.glob('./articles/*.md');
const sortedPosts = allPosts.sort((a, b) => 
  new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime()
);

// Extraction des catégories uniques
const categories = [...new Set(allPosts.map(post => post.frontmatter.category))];

// Fonction helper pour formater les dates
const formatDate = (date) => new Date(date).toLocaleDateString('fr-FR', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});

// Données structurées simplifiées mais complètes
const blogSchema = {
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Blog Expert-Comptable Luxembourg",
  "description": "Blog spécialisé comptabilité, fiscalité et création société Luxembourg",
  "url": "https://www.fiduciaire-expert.lu/articles",
  "publisher": {
    "@type": "Organization",
    "name": "Fiduciaire Expert Luxembourg",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.fiduciaire-expert.lu/images/logo.png"
    }
  },
  "blogPost": sortedPosts.slice(0, 10).map(post => ({
    "@type": "BlogPosting",
    "headline": post.frontmatter.title,
    "url": `https://www.fiduciaire-expert.lu${post.url}`,
    "datePublished": post.frontmatter.date,
    "author": {"@type": "Person", "name": post.frontmatter.author}
  }))
};
---

<Layout 
  title="Blog Expert-Comptable Luxembourg | Conseils Fiscalité & Comptabilité"
  description={`${sortedPosts.length}+ articles sur comptabilité, fiscalité, création SARL au Luxembourg. Conseils experts PME.`}
  canonical="https://www.fiduciaire-expert.lu/articles"
>
  <main class="blog-page">
    
    <!-- Breadcrumb simplifié -->
    <nav class="breadcrumb" aria-label="Fil d'ariane">
      <div class="container">
        <ol>
          <li><a href="/">Accueil</a></li>
          <li aria-current="page">Blog Expert-Comptable</li>
        </ol>
      </div>
    </nav>

    <!-- Header -->
    <header class="blog-header">
      <div class="container">
        <h1>Blog Expert-Comptable Luxembourg</h1>
        <p class="lead">
          Conseils pratiques en comptabilité, fiscalité et gestion d'entreprise au Luxembourg
        </p>
        <div class="stats">
          <span><strong>{sortedPosts.length}</strong> articles</span>
          <span><strong>{categories.length}</strong> catégories</span>
        </div>
      </div>
    </header>

    <!-- Filtres -->
    <section class="filters" aria-label="Filtres">
      <div class="container">
        <nav class="category-nav">
          <a href="/articles" class="active" aria-current="page">Tous</a>
          {categories.map(cat => (
            <a href={`/articles/category/${(cat || '').toLowerCase().replace(/\s+/g, '-')}`}>
              {cat}
            </a>
          ))}
        </nav>
      </div>
    </section>

    <!-- Grille d'articles -->
    <section class="articles">
      <div class="container">
        <h2 class="visually-hidden">Liste des articles</h2>
        
        <div class="grid">
          {sortedPosts.map((post, i) => (
            <article class="card">
              <a href={post.url} class="card-link">
                {post.frontmatter.image && (
                  <img 
                    src={post.frontmatter.image} 
                    alt=""
                    loading={i < 3 ? 'eager' : 'lazy'}
                    width="400"
                    height="225"
                    class="card-image"
                  />
                )}
                
                <div class="card-body">
                  <div class="meta">
                    <span class="category">{post.frontmatter.category}</span>
                    <time datetime={post.frontmatter.date}>
                      {formatDate(post.frontmatter.date)}
                    </time>
                  </div>
                  
                  <h3>{post.frontmatter.title}</h3>
                  
                  {post.frontmatter.description && (
                    <p>{post.frontmatter.description}</p>
                  )}
                  
                  <footer>
                    Par {post.frontmatter.author}
                  </footer>
                </div>
              </a>
            </article>
          ))}
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="cta">
      <div class="container">
        <h2>Besoin d'un Expert-Comptable ?</h2>
        <p>Contactez-nous pour un accompagnement personnalisé</p>
        <a href="/contact" class="btn btn-primary">Consultation gratuite</a>
      </div>
    </section>

  </main>

  <script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
</Layout>

<style>
  /* Variables CSS */
  :root {
    --primary: #2c3e50;
    --accent: #3498db;
    --text: #2c3e50;
    --text-light: #7f8c8d;
    --bg: #ffffff;
    --bg-light: #f8f9fa;
    --border: #e9ecef;
    --shadow: 0 2px 4px rgba(0,0,0,0.1);
    --shadow-hover: 0 4px 12px rgba(0,0,0,0.15);
    --cta-bg: #2c3e50; /* Bleu foncé comme sur votre site */
  }

  /* Reset & Base */
  * {
    box-sizing: border-box;
  }

  /* Utility */
  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .visually-hidden {
    clip: rect(0 0 0 0);
    clip-path: inset(50%);
    height: 1px;
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: 1px;
  }

  /* Breadcrumb */
  .breadcrumb {
    background: var(--bg-light);
    padding: 1rem 0;
  }

  .breadcrumb ol {
    display: flex;
    gap: 0.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
    font-size: 0.875rem;
  }

  .breadcrumb li:not(:last-child)::after {
    content: "›";
    margin-left: 0.5rem;
    color: var(--text-light);
  }

  .breadcrumb a {
    color: var(--accent);
    text-decoration: none;
  }

  .breadcrumb a:hover {
    text-decoration: underline;
  }

  /* Header */
  .blog-header {
    padding: 3rem 0;
    text-align: center;
  }

  .blog-header h1 {
    font-size: clamp(2rem, 5vw, 2.5rem);
    color: var(--primary);
    margin: 0 0 1rem;
  }

  .lead {
    font-size: 1.125rem;
    color: var(--text-light);
    margin: 0 auto 2rem;
    max-width: 600px;
  }

  .stats {
    display: flex;
    justify-content: center;
    gap: 2rem;
    color: var(--text-light);
  }

  .stats strong {
    color: var(--accent);
    font-size: 1.5rem;
  }

  /* Filtres */
  .filters {
    background: var(--bg-light);
    padding: 1.5rem 0;
    position: sticky;
    top: 0;
    z-index: 10;
    border-bottom: 1px solid var(--border);
  }

  .category-nav {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.25rem;
  }

  .category-nav a {
    padding: 0.5rem 1rem;
    color: var(--text);
    text-decoration: none;
    border: 1px solid var(--border);
    border-radius: 2rem;
    white-space: nowrap;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .category-nav a:hover,
  .category-nav a.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  /* Articles Grid */
  .articles {
    padding: 3rem 0;
    background: var(--bg-light);
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
  }

  /* Card */
  .card {
    background: var(--bg);
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: box-shadow 0.2s;
  }

  .card:hover {
    box-shadow: var(--shadow-hover);
  }

  .card-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .card-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .card-body {
    padding: 1.5rem;
  }

  .meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
  }

  .category {
    color: var(--accent);
    font-weight: 500;
  }

  .meta time {
    color: var(--text-light);
  }

  .card h3 {
    margin: 0 0 0.75rem;
    font-size: 1.25rem;
    line-height: 1.3;
    color: var(--primary);
  }

  .card p {
    margin: 0 0 1rem;
    color: var(--text-light);
    line-height: 1.5;
  }

  .card footer {
    font-size: 0.875rem;
    color: var(--text-light);
  }

  /* CTA */
  .cta {
    padding: 4rem 0;
    text-align: center;
    background: var(--cta-bg);
    color: white;
  }

  .cta h2 {
    margin: 0 0 0.5rem;
    font-size: 2rem;
    color: white;
  }

  .cta p {
    margin: 0 0 2rem;
    opacity: 0.9;
    color: white;
  }

  .btn {
    display: inline-block;
    padding: 0.75rem 2rem;
    text-decoration: none;
    border-radius: 0.25rem;
    font-weight: 500;
    transition: transform 0.2s;
  }

  .btn:hover {
    transform: translateY(-2px);
  }

  .btn-primary {
    background: var(--accent);
    color: white;
  }

  .btn-primary:hover {
    background: #2980b9; /* Version plus foncée de l'accent */
  }

  /* Responsive */
  @media (max-width: 768px) {
    .stats {
      gap: 1rem;
    }
    
    .filters {
      position: static;
    }
    
    .grid {
      grid-template-columns: 1fr;
    }
  }
</style>