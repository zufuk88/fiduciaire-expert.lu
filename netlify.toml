[build]
  publish = "dist"
  command = "npm run build"

# ===========================================
# REWRITES INVISIBLES (status 200)
# ===========================================

# 1. REWRITES SPÉCIFIQUES pour les anciennes URLs (plus prioritaires)
[[redirects]]
  from = "/services"
  to = "/fr/services"
  status = 200

[[redirects]]
  from = "/comptabilite"
  to = "/fr/comptabilite"
  status = 200

[[redirects]]
  from = "/fiscalite"
  to = "/fr/fiscalite"
  status = 200

[[redirects]]
  from = "/creation-societe-luxembourg"
  to = "/fr/creation-societe-luxembourg"
  status = 200

[[redirects]]
  from = "/paie"
  to = "/fr/paie"
  status = 200

[[redirects]]
  from = "/domiciliation"
  to = "/fr/domiciliation"
  status = 200

[[redirects]]
  from = "/a-propos"
  to = "/fr/a-propos"
  status = 200

[[redirects]]
  from = "/contact"
  to = "/fr/contact"
  status = 200

[[redirects]]
  from = "/articles"
  to = "/fr/articles"
  status = 200

[[redirects]]
  from = "/articles/*"
  to = "/fr/articles/:splat"
  status = 200

[[redirects]]
  from = "/mentions-legales"
  to = "/fr/mentions-legales"
  status = 200

[[redirects]]
  from = "/politique-confidentialite"
  to = "/fr/politique-confidentialite"
  status = 200

# 2. DÉTECTION DE LANGUE pour la page d'accueil
# Note: Netlify utilise "Language" pour le header Accept-Language
[[redirects]]
  from = "/"
  to = "/fr/"
  status = 200
  force = false
  conditions = {Language = ["fr", "fr-FR", "fr-LU", "fr-BE", "fr-CH", "fr-CA"]}

[[redirects]]
  from = "/"
  to = "/en/"
  status = 200
  force = false
  conditions = {Language = ["en", "en-US", "en-GB", "en-CA", "en-AU"]}

# 3. FALLBACK par défaut vers le français
[[redirects]]
  from = "/"
  to = "/fr/"
  status = 200
  force = false

# Note: Pas de catch-all /* car cela peut interférer avec les assets statiques

[build.processing]
  skip_processing = false

[build.processing.css]
  bundle = true
  minify = true

[build.processing.js]
  bundle = true
  minify = true

[build.processing.html]
  pretty_urls = true

[build.processing.images]
  compress = true

[[headers]]
  for = "/netlify-forms.html"
  [headers.values]
    X-Robots-Tag = "noindex"

# Configuration pour les formulaires
[forms]
  enabled = true

# Redirections après soumission de formulaire
# Ces règles s'appliquent après que Netlify ait traité le formulaire
[[redirects]]
  from = "/fr/contact"
  to = "/fr/merci"
  status = 303
  conditions = {Role = ["netlify"]}
  force = false
  query = {form = ["contact-fiduciaire"]}

[[redirects]]
  from = "/en/contact"
  to = "/en/contact/thank-you"
  status = 303
  conditions = {Role = ["netlify"]}
  force = false
  query = {form = ["contact-fiduciaire"]}